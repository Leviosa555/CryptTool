<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA Encryption/Decryption</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .mode-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .mode-btn {
            flex: 1;
            max-width: 200px;
            padding: 15px 30px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        .key-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .key-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .key-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .key-label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }

        .generate-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .input-section {
            margin-bottom: 25px;
        }

        label {
            display: block;
            color: #333;
            font-weight: bold;
            margin-bottom: 8px;
        }

        textarea, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        textarea:focus, input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 120px;
        }

        .action-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .output-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
        }

        .output-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .output-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            min-height: 100px;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
        }

        .hidden {
            display: none;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .info-box p {
            margin: 5px 0;
            color: #1565C0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SGBIT RSA ENCRYPTION</h1>
        <p class="subtitle">Secure Encryption & Decryption Tool</p>

        <div class="mode-selector">
            <button class="mode-btn active" id="encryptModeBtn" onclick="switchMode('encrypt')">
                🔒 Encrypt
            </button>
            <button class="mode-btn" id="decryptModeBtn" onclick="switchMode('decrypt')">
                🔓 Decrypt
            </button>
        </div>

        <div class="key-section">
            <h3>RSA Keys</h3>
            <div class="key-display">
                <div class="key-label">Public Key (n, e):</div>
                <div id="publicKey">Click "Generate Keys" to create new keys</div>
            </div>
            <div class="key-display">
                <div class="key-label">Private Key (n, d):</div>
                <div id="privateKey">Click "Generate Keys" to create new keys</div>
            </div>
            <button class="generate-btn" onclick="generateKeys()"> Generate Random Keys</button>
            <button class="generate-btn" onclick="toggleManualKeys()" style="margin-top: 10px; background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);"> Enter Keys Manually</button>
            
            <div id="manualKeysSection" class="hidden" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #ddd;">
                <div style="margin-bottom: 15px;">
                    <label style="color: #555; font-size: 0.95em;">Public Key - Enter n:</label>
                    <input type="number" id="manualN" placeholder="e.g., 3233" style="margin-top: 5px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #555; font-size: 0.95em;">Public Key - Enter e:</label>
                    <input type="number" id="manualE" placeholder="e.g., 17" style="margin-top: 5px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #555; font-size: 0.95em;">Private Key - Enter d:</label>
                    <input type="number" id="manualD" placeholder="e.g., 2753" style="margin-top: 5px;">
                </div>
                <button class="generate-btn" onclick="setManualKeys()" style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);">✓ Set These Keys</button>
            </div>
        </div>

        <div id="encryptSection">
            
            <div class="input-section">
                <label for="plaintext">Enter Message to Encrypt:</label>
                <textarea id="plaintext" placeholder="Type your secret message here...."></textarea>
            </div>

            <button class="action-btn" onclick="encryptMessage()">🔒 Encrypt Message</button>
        </div>

        <div id="decryptSection" class="hidden">
            
            <div class="input-section">
                <label for="ciphertext">Enter Encrypted Message:</label>
                <textarea id="ciphertext" placeholder="Paste encrypted message here..."></textarea>
            </div>

            <button class="action-btn" onclick="decryptMessage()">🔓 Decrypt Message</button>
        </div>

        <div class="output-section">
            <h3>Output</h3>
            <div class="output-box" id="output">Results will appear here...</div>
        </div>
    </div>

    <script>
        let publicKey = null;
        let privateKey = null;

        function isPrime(num) {
            if (num < 2) return false;
            if (num === 2) return true;
            if (num % 2 === 0) return false;
            
            for (let i = 3; i <= Math.sqrt(num); i += 2) {
                if (num % i === 0) return false;
            }
            return true;
        }

        function generatePrime(min, max) {
            let prime = Math.floor(Math.random() * (max - min + 1)) + min;
            while (!isPrime(prime)) {
                prime = Math.floor(Math.random() * (max - min + 1)) + min;
            }
            return prime;
        }

        function gcd(a, b) {
            while (b !== 0) {
                let temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        function modInverse(e, phi) {
            let m0 = phi, t, q;
            let x0 = 0, x1 = 1;

            if (phi === 1) return 0;

            while (e > 1) {
                q = Math.floor(e / phi);
                t = phi;
                phi = e % phi;
                e = t;
                t = x0;
                x0 = x1 - q * x0;
                x1 = t;
            }

            if (x1 < 0) x1 += m0;

            return x1;
        }

        function modPow(base, exp, mod) {
            let result = 1;
            base = base % mod;
            
            while (exp > 0) {
                if (exp % 2 === 1) {
                    result = (result * base) % mod;
                }
                exp = Math.floor(exp / 2);
                base = (base * base) % mod;
            }
            
            return result;
        }

        function generateKeys() {

            const p = generatePrime(50, 150);
            let q = generatePrime(50, 150);
            while (q === p) {
                q = generatePrime(50, 150);
            }

            const n = p * q;

            const phi = (p - 1) * (q - 1);

            let e = 65537;
            if (e >= phi) {
                e = 3;
                while (gcd(e, phi) !== 1) {
                    e += 2;
                }
            }

            const d = modInverse(e, phi);

            publicKey = { n: n, e: e };
            privateKey = { n: n, d: d };

            document.getElementById('publicKey').textContent = `(n: ${n}, e: ${e})`;
            document.getElementById('privateKey').textContent = `(n: ${n}, d: ${d})`;
            document.getElementById('output').textContent = '';
        }

        function toggleCustomKeys() {
            const customSection = document.getElementById('customKeysSection');
            const manualSection = document.getElementById('manualKeysSection');
            customSection.classList.toggle('hidden');
            if (!customSection.classList.contains('hidden')) {
                manualSection.classList.add('hidden');
            }
        }

        function toggleManualKeys() {
            const manualSection = document.getElementById('manualKeysSection');
            const customSection = document.getElementById('customKeysSection');
            manualSection.classList.toggle('hidden');
            if (!manualSection.classList.contains('hidden')) {
                customSection.classList.add('hidden');
            }
        }

        function generateCustomKeys() {
            const pInput = parseInt(document.getElementById('primeP').value);
            const qInput = parseInt(document.getElementById('primeQ').value);
            const eInput = document.getElementById('exponentE').value;

            if (!pInput || !qInput) {
                document.getElementById('output').textContent = '❌ Error: Please enter both prime numbers p and q!';
                return;
            }

            if (!isPrime(pInput)) {
                document.getElementById('output').textContent = `❌ Error: ${pInput} is not a prime number! Please enter a valid prime for p.`;
                return;
            }

            if (!isPrime(qInput)) {
                document.getElementById('output').textContent = `❌ Error: ${qInput} is not a prime number! Please enter a valid prime for q.`;
                return;
            }

            if (pInput === qInput) {
                document.getElementById('output').textContent = '❌ Error: p and q must be different prime numbers!';
                return;
            }

            const p = pInput;
            const q = qInput;

            const n = p * q;

            const phi = (p - 1) * (q - 1);

            let e;
            if (eInput && parseInt(eInput) > 1) {
                e = parseInt(eInput);
                if (e >= phi) {
                    document.getElementById('output').textContent = `❌ Error: e must be less than phi(n) = ${phi}`;
                    return;
                }
                if (gcd(e, phi) !== 1) {
                    document.getElementById('output').textContent = `❌ Error: e must be coprime with phi(n) = ${phi}. GCD(${e}, ${phi}) = ${gcd(e, phi)}`;
                    return;
                }
            } else {

                e = 65537;
                if (e >= phi) {
                    e = 3;
                    while (gcd(e, phi) !== 1 && e < phi) {
                        e += 2;
                    }
                    if (gcd(e, phi) !== 1) {
                        document.getElementById('output').textContent = '❌ Error: Could not find suitable e value. Try larger primes.';
                        return;
                    }
                }
            }

            const d = modInverse(e, phi);

            if (d <= 0) {
                document.getElementById('output').textContent = '❌ Error: Could not calculate private key. Please try different values.';
                return;
            }

            publicKey = { n: n, e: e };
            privateKey = { n: n, d: d };

            document.getElementById('publicKey').textContent = `(n: ${n}, e: ${e})`;
            document.getElementById('privateKey').textContent = `(n: ${n}, d: ${d})`;
            document.getElementById('output').innerHTML = 
                `<strong>✅ Custom RSA keys generated successfully!</strong><br><br>` +
                `<strong>Parameters:</strong><br>` +
                `p = ${p}<br>` +
                `q = ${q}<br>` +
                `n = p × q = ${n}<br>` +
                `φ(n) = (p-1) × (q-1) = ${phi}<br>` +
                `e = ${e}<br>` +
                `d = ${d}`;
        }

        function setManualKeys() {
            const nInput = parseInt(document.getElementById('manualN').value);
            const eInput = parseInt(document.getElementById('manualE').value);
            const dInput = parseInt(document.getElementById('manualD').value);

            if (!nInput || !eInput || !dInput) {
                document.getElementById('output').textContent = '❌ Error: Please enter all three values (n, e, d)!';
                return;
            }

            if (nInput <= 0 || eInput <= 0 || dInput <= 0) {
                document.getElementById('output').textContent = '❌ Error: All values must be positive integers!';
                return;
            }

            if (eInput >= nInput) {
                document.getElementById('output').textContent = '❌ Error: e must be less than n!';
                return;
            }

            if (dInput >= nInput) {
                document.getElementById('output').textContent = '❌ Error: d must be less than n!';
                return;
            }

            publicKey = { n: nInput, e: eInput };
            privateKey = { n: nInput, d: dInput };

            document.getElementById('publicKey').textContent = `(n: ${nInput}, e: ${eInput})`;
            document.getElementById('privateKey').textContent = `(n: ${nInput}, d: ${dInput})`;
            document.getElementById('output').innerHTML = 
                `<strong>✅ RSA keys set successfully!</strong><br><br>` +
                `<strong>Public Key:</strong> (n: ${nInput}, e: ${eInput})<br>` +
                `<strong>Private Key:</strong> (n: ${nInput}, d: ${dInput})<br><br>` +
                `<em>Note: Make sure these keys are mathematically valid for proper encryption/decryption.</em>`;
        }

        function encryptMessage() {
            if (!publicKey) {
                document.getElementById('output').textContent = '❌ Error: Please generate keys first!';
                return;
            }

            const plaintext = document.getElementById('plaintext').value;
            if (!plaintext) {
                document.getElementById('output').textContent = '❌ Error: Please enter a message to encrypt!';
                return;
            }

            try {
                const encrypted = [];
                for (let i = 0; i < plaintext.length; i++) {
                    const charCode = plaintext.charCodeAt(i);
                    const encryptedChar = modPow(charCode, publicKey.e, publicKey.n);
                    encrypted.push(encryptedChar);
                }

                const encryptedMessage = encrypted.join(',');
                document.getElementById('output').innerHTML = 
                    `<strong>Encryption Successful!</strong><br><br>` +
                    `<strong>Encrypted Message:</strong><br>${encryptedMessage}<br><br>`;
            } catch (error) {
                document.getElementById('output').textContent = '❌ Error during encryption: ' + error.message;
            }
        }

        function decryptMessage() {
            if (!privateKey) {
                document.getElementById('output').textContent = '❌ Error: Please generate keys first!';
                return;
            }
            const ciphertext = document.getElementById('ciphertext').value;
            if (!ciphertext) {
                document.getElementById('output').textContent = '❌ Error: Please enter an encrypted message!';
                return;
            }

            try {
                const encrypted = ciphertext.split(',').map(num => parseInt(num.trim()));

                let decrypted = '';
                for (let i = 0; i < encrypted.length; i++) {
                    const decryptedChar = modPow(encrypted[i], privateKey.d, privateKey.n);
                    decrypted += String.fromCharCode(decryptedChar);
                }

                document.getElementById('output').innerHTML = 
                    `<strong>Decryption Successful!</strong><br><br>` +
                    `<strong>Original Message:</strong><br>${decrypted}`;
            } catch (error) {
                document.getElementById('output').textContent = '❌ Error during decryption: ' + error.message + '\n\nMake sure you copied the entire encrypted message.';
            }
        }

        function switchMode(mode) {
            const encryptBtn = document.getElementById('encryptModeBtn');
            const decryptBtn = document.getElementById('decryptModeBtn');
            const encryptSection = document.getElementById('encryptSection');
            const decryptSection = document.getElementById('decryptSection');

            if (mode === 'encrypt') {
                encryptBtn.classList.add('active');
                decryptBtn.classList.remove('active');
                encryptSection.classList.remove('hidden');
                decryptSection.classList.add('hidden');
                document.getElementById('output').textContent = 'Ready to encrypt...';
            } else {
                decryptBtn.classList.add('active');
                encryptBtn.classList.remove('active');
                decryptSection.classList.remove('hidden');
                encryptSection.classList.add('hidden');
                document.getElementById('output').textContent = 'Ready to decrypt...';
            }
        }

        window.onload = function() {
            generateKeys();
        };
    </script>
</body>
</html>
